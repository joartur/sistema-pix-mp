<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pagamentos PIX • Processamento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style>
        * { font-family: 'Inter', sans-serif; }
        body { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); min-height: 100vh; }
        .card-shadow { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15); }
        .gradient-primary { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); }
        .gradient-success { background: linear-gradient(135deg, #059669 0%, #047857 100%); }
        .gradient-warning { background: linear-gradient(135deg, #d97706 0%, #b45309 100%); }
        
        .progress-animation {
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #10b981, #3b82f6, #ef4444);
            background-size: 300% 100%;
            animation: progressAnimation 30s linear forwards;
        }
        
        @keyframes progressAnimation {
            0% { background-position: 100% 0; width: 100%; }
            70% { background-position: 0 0; width: 30%; }
            100% { background-position: 0 0; width: 0%; }
        }
        
        .btn-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .qr-code-container:hover { box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1); transform: translateY(-5px); }
        
        .status-pending { background-color: #fef3c7; color: #92400e; border-color: #fbbf24; }
        .status-processing { background-color: #dbeafe; color: #1e40af; border-color: #60a5fa; }
        .status-completed { background-color: #d1fae5; color: #065f46; border-color: #10b981; }
    </style>
</head>
<body class="p-4 md:p-6">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between bg-white rounded-2xl card-shadow p-6">
                <div class="flex items-center mb-6 md:mb-0">
                    <a href="index.html" class="flex items-center text-gray-700 hover:text-blue-600 transition-colors mr-8">
                        <i class="fas fa-arrow-left mr-3 text-lg"></i>
                        <span class="font-medium">Voltar</span>
                    </a>
                    <div class="flex items-center">
                        <div class="w-12 h-12 gradient-primary rounded-xl flex items-center justify-center mr-4">
                            <i class="fas fa-lock text-white text-xl"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">Pagamento PIX</h1>
                            <p class="text-gray-600">Processamento seguro em tempo real</p>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Conteúdo Principal -->
        <div class="grid lg:grid-cols-2 gap-8 mb-8">
            <!-- Coluna Esquerda - Informações -->
            <div>
                <div class="bg-white rounded-2xl card-shadow p-6 mb-8">
                    <!-- Valor -->
                    <div class="text-center mb-8">
                        <p class="text-gray-600 mb-3 font-medium">VALOR A PAGAR</p>
                        <div id="paymentAmountDisplay" class="text-6xl font-bold text-green-600 mb-4">Carregando...</div>
                    </div>
                    
                    <!-- Instruções -->
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-gray-900 mb-5">Como realizar o pagamento</h3>
                        <div class="space-y-4">
                            <div class="flex items-start bg-blue-50 p-4 rounded-xl">
                                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center mr-4 border">
                                    <span class="text-blue-700 font-bold">1</span>
                                </div>
                                <div>
                                    <p class="font-medium text-blue-900">Abra seu app bancário</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start bg-blue-50 p-4 rounded-xl">
                                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center mr-4 border">
                                    <span class="text-blue-700 font-bold">2</span>
                                </div>
                                <div>
                                    <p class="font-medium text-blue-900">Selecione "Pagar com PIX"</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start bg-blue-50 p-4 rounded-xl">
                                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center mr-4 border">
                                    <span class="text-blue-700 font-bold">3</span>
                                </div>
                                <div>
                                    <p class="font-medium text-blue-900">Escaneie o QR Code</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start bg-blue-50 p-4 rounded-xl">
                                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center mr-4 border">
                                    <span class="text-blue-700 font-bold">4</span>
                                </div>
                                <div>
                                    <p class="font-medium text-blue-900">Confirme o pagamento</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Timer -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <i class="fas fa-clock text-gray-700 mr-3"></i>
                                <span class="text-gray-900 font-semibold">Tempo restante</span>
                            </div>
                            <div class="flex items-center">
                                <span id="countdown" class="text-3xl font-bold text-gray-900 mr-3">30:00</span>
                                <div class="w-4 h-4 bg-green-500 rounded-full"></div>
                            </div>
                        </div>
                        <div class="progress-animation"></div>
                    </div>
                    
                    <!-- Status -->
                    <div class="mb-8">
                        <div id="statusContainer" class="status-pending border rounded-xl p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium mb-1" id="statusText">Aguardando pagamento</div>
                                    <div class="text-sm" id="statusDescription">Escaneie o QR Code para pagar</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Botões -->
                    <button onclick="checkPaymentStatus()" class="w-full py-4 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition-colors mb-4">
                        <i class="fas fa-sync-alt mr-2"></i>
                        Verificar Status
                    </button>
                    
                    <button onclick="createNewPayment()" class="w-full py-4 bg-white border-2 border-blue-500 text-blue-600 font-semibold rounded-xl hover:bg-blue-50 transition-colors">
                        <i class="fas fa-plus-circle mr-2"></i>
                        Novo Pagamento
                    </button>
                </div>
            </div>

            <!-- Coluna Direita - QR Code -->
            <div>
                <div class="bg-white rounded-2xl card-shadow p-6 h-full">
                    <!-- QR Code -->
                    <div class="text-center mb-8">
                        <div class="qr-code-container p-4 mb-6">
                            <div id="qrCodeDisplay" class="w-72 h-72 mx-auto flex items-center justify-center">
                                <!-- QR Code será carregado aqui -->
                            </div>
                        </div>
                        <p class="text-gray-600">Escaneie com a câmera do seu celular</p>
                    </div>
                    
                    <!-- Código PIX Copiável -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold text-gray-900">
                                <i class="fas fa-key mr-2 text-blue-500"></i>
                                Código PIX
                            </h3>
                            <button onclick="copyPixCode()" id="copyButton" class="px-4 py-2 gradient-primary text-white rounded-lg flex items-center">
                                <i class="far fa-copy mr-2"></i>
                                Copiar
                            </button>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-xl border">
                            <div id="pixCodeDisplay" class="font-mono text-sm text-gray-800 break-all"></div>
                        </div>
                        
                        <p class="text-gray-500 text-xs mt-3">
                            <i class="fas fa-info-circle mr-2"></i>
                            Cole no campo PIX do seu banco
                        </p>
                    </div>
                    
                    <!-- Informações -->
                    <div class="pt-6 border-t">
                        <h4 class="font-semibold text-gray-900 mb-4">Informações da transação</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">ID:</span>
                                <span id="transactionId" class="font-mono font-medium"></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Data:</span>
                                <span id="transactionDate" class="font-medium"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let countdownInterval;
        let timeRemaining = 30 * 60;
        
        // Função para gerar QR Code
        function generateQRCode(text, elementId) {
            const qrContainer = document.getElementById(elementId);
            qrContainer.innerHTML = '';
            
            // API do Google Charts para QR Code
            const qrUrl = `https://chart.googleapis.com/chart?chs=250x250&cht=qr&chl=${encodeURIComponent(text)}&choe=UTF-8`;
            
            const img = document.createElement('img');
            img.src = qrUrl;
            img.alt = 'QR Code PIX';
            img.className = 'w-full h-auto';
            qrContainer.appendChild(img);
        }
        
        // Timer
        function startCountdown() {
            const countdownElement = document.getElementById('countdown');
            
            countdownInterval = setInterval(() => {
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                
                countdownElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeRemaining < 5 * 60) {
                    countdownElement.classList.add('text-red-600');
                }
                
                if (timeRemaining <= 0) {
                    clearInterval(countdownInterval);
                    countdownElement.textContent = '00:00';
                    updateStatus('expired', 'QR Code expirado');
                }
                
                timeRemaining--;
            }, 1000);
        }
        
        function updateStatus(status, message) {
            const container = document.getElementById('statusContainer');
            const text = document.getElementById('statusText');
            
            container.className = 'border rounded-xl p-4';
            text.textContent = message;
            
            switch(status) {
                case 'pending':
                    container.classList.add('status-pending');
                    break;
                case 'processing':
                    container.classList.add('status-processing');
                    break;
                case 'completed':
                    container.classList.add('status-completed');
                    break;
            }
        }
        
        function checkPaymentStatus() {
            showNotification('Verificando pagamento...', 'info');
            
            setTimeout(() => {
                const random = Math.random();
                if (random > 0.7) {
                    updateStatus('completed', 'Pagamento confirmado!');
                    showNotification('Pagamento confirmado com sucesso!', 'success');
                    clearInterval(countdownInterval);
                } else if (random > 0.4) {
                    updateStatus('processing', 'Processando pagamento');
                    showNotification('Pagamento em processamento', 'info');
                } else {
                    updateStatus('pending', 'Aguardando pagamento');
                    showNotification('Ainda aguardando pagamento', 'warning');
                }
            }, 1500);
        }
        
        function copyPixCode() {
            const pixCode = document.getElementById('pixCodeDisplay').textContent;
            const copyBtn = document.getElementById('copyButton');
            
            navigator.clipboard.writeText(pixCode)
                .then(() => {
                    copyBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Copiado!';
                    copyBtn.classList.add('bg-green-600');
                    showNotification('Código copiado!', 'success');
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = '<i class="far fa-copy mr-2"></i>Copiar';
                        copyBtn.classList.remove('bg-green-600');
                    }, 2000);
                })
                .catch(() => {
                    showNotification('Erro ao copiar', 'error');
                });
        }
        
        function createNewPayment() {
            window.location.href = 'index.html';
        }
        
        function showNotification(message, type) {
            const colors = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-yellow-600',
                info: 'bg-blue-600'
            };
            
            const toast = document.createElement('div');
            toast.className = `fixed top-6 right-6 ${colors[type]} text-white px-6 py-4 rounded-xl shadow-2xl z-50 max-w-md`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation' : 'info'}-circle mr-3"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        
        // Carregar dados do pagamento
        document.addEventListener('DOMContentLoaded', () => {
            const savedPayment = localStorage.getItem('currentPayment');
            
            if (!savedPayment) {
                showNotification('Nenhum pagamento encontrado. Voltando...', 'error');
                setTimeout(() => window.location.href = 'index.html', 2000);
                return;
            }
            
            try {
                const payment = JSON.parse(savedPayment);
                
                // Preencher informações
                document.getElementById('paymentAmountDisplay').textContent = `R$ ${parseFloat(payment.amount).toFixed(2)}`;
                document.getElementById('transactionId').textContent = payment.id;
                document.getElementById('pixCodeDisplay').textContent = payment.pixCode;
                
                // Formatar data
                const date = new Date(payment.timestamp);
                document.getElementById('transactionDate').textContent = 
                    date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR');
                
                // Gerar QR Code
                generateQRCode(payment.pixCode, 'qrCodeDisplay');
                
                // Iniciar timer
                startCountdown();
                
            } catch (error) {
                console.error('Erro ao carregar pagamento:', error);
                showNotification('Erro ao carregar pagamento', 'error');
                setTimeout(() => window.location.href = 'index.html', 2000);
            }
        });
    </script>
</body>
</html>